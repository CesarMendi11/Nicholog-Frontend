<div class="dashboard-container" *ngIf="stats$ | async as stats; else loading">
  
  <div class="welcome-section">
    <h1>Panel de Control</h1>
    <p>Resumen financiero y analítico de tu colección.</p>
  </div>

  <!-- WIDGETS FINANCIEROS -->
  <div class="widgets-grid">
    <mat-card class="widget-card cost-card">
      <mat-card-content>
        <div class="widget-icon"><mat-icon>shopping_bag</mat-icon></div>
        <div class="widget-data">
          <span class="label">Costo Total</span>
          <span class="value">{{ stats.totalCost | currency }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="widget-card value-card">
      <mat-card-content>
        <div class="widget-icon"><mat-icon>trending_up</mat-icon></div>
        <div class="widget-data">
          <span class="label">Valor Estimado</span>
          <span class="value">{{ stats.totalValue | currency }}</span>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="widget-card count-card">
      <mat-card-content>
        <div class="widget-icon"><mat-icon>inventory_2</mat-icon></div>
        <div class="widget-data">
          <span class="label">Artículos</span>
          <span class="value">{{ stats.itemCount }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- GRÁFICOS -->
  <div class="charts-section">
    <mat-card class="chart-card">
      <mat-card-header>
        <mat-card-title>Distribución de Inversión</mat-card-title>
      </mat-card-header>
      <mat-card-content class="chart-content">
        <div class="pie-chart-container">
          <div class="pie-chart" [style.background]="pieChartStyle$ | async"></div>
        </div>
        <div class="chart-legend">
          <div *ngFor="let cat of stats.categoryDistribution" class="legend-item">
            <span class="color-dot" [style.background-color]="cat.color"></span>
            <span class="cat-name">{{ cat.label }}</span>
            <span class="cat-value">{{ cat.percentage }}%</span>
          </div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>

<ng-template #loading>
  <div class="loading-container"><mat-progress-spinner mode="indeterminate"></mat-progress-spinner></div>
</ng-template>
